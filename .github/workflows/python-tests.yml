name: Run Tests & Notify Telegram

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: ["3.10", "3.11", "3.12"]  # –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –∫–æ–¥ –Ω–∞ —Ä—ñ–∑–Ω–∏—Ö –≤–µ—Ä—Å—ñ—è—Ö Python

    steps:
      - name: Checkout —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é
        uses: actions/checkout@v4

      - name: –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è Python
        uses: actions/setup-python@v4
        with:
          python-version: ${{ matrix.python-version }}

      - name: –ö–µ—à—É–≤–∞–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π pip
        uses: actions/cache@v3
        with:
          path: ~/.cache/pip
          key: ${{ runner.os }}-pip-${{ hashFiles('**/requirements.txt') }}
          restore-keys: ${{ runner.os }}-pip-

      - name: –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π
        run: |
          pip install --upgrade pip
          pip install -r requirements.txt

      - name: –ó–∞–ø—É—Å–∫ pre-commit –ø–µ—Ä–µ–≤—ñ—Ä–æ–∫
        run: pre-commit run --all-files || (echo "‚ùå Pre-commit –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø—Ä–æ–≤–∞–ª–∏–ª–∏—Å—è!" && exit 1)

      - name: –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç—ñ–≤
        run: python -m unittest discover
          
      - name: –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —É —Ä–∞–∑—ñ –ø—Ä–æ–≤–∞–ª—É —Ç–µ—Å—Ç—ñ–≤
        if: failure()
        run: |
          curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage" \
          -d "chat_id=${{ secrets.TELEGRAM_CHAT_ID }}" \
          -d "text=‚ùå –¢–µ—Å—Ç–∏ –≤–ø–∞–ª–∏ —É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó ${{ github.repository }}! üö® –ü–µ—Ä–µ–≤—ñ—Ä –∫–æ–¥: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}"
